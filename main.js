!function(){"use strict";const e=e=>Number.parseInt(e,10);var t,o,n;!function(e){e[e.ROUTE=0]="ROUTE",e[e.STOP=1]="STOP",e[e.TRIP=2]="TRIP"}(o||(o={})),function(e){e[e.LIST=0]="LIST",e[e.MAP_PRIMARY=1]="MAP_PRIMARY",e[e.STREET_PRIMARY=2]="STREET_PRIMARY"}(n||(n={}));let s={Route:{ID:null,TRIP:null},STOP:null,View:{ROUTE:n.LIST,STOP:n.MAP_PRIMARY}};const i=new CustomEvent("pageupdate");null===(t=navigator.serviceWorker)||void 0===t||t.register("service-worker.js");const a={},r={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:0,y:0},anchor:{x:12,y:12}},c={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:96,y:0},anchor:{x:12,y:12}},l={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:48,y:0},anchor:{x:12,y:12}},d={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:72,y:0},anchor:{x:12,y:23}},u={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:24,y:0},anchor:{x:12,y:20}};function p(e){s=e}function g(e,t){return Object.assign(document.createElement(e),t)}function m(e,t){let o;o=t?Promise.resolve({coords:t,customLocationFlag:!0}):new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)});let n,s=Number.MAX_VALUE;return Promise.all([o,e]).then(([e,t])=>{const o=e.coords;for(const e of Object.keys(t.stops)){const i=t.stops[e],a=Math.sqrt(Math.pow(o.latitude-parseFloat(i.stop_lat),2)+Math.pow(o.longitude-parseFloat(i.stop_lon),2));a<s&&(n=e,s=a)}if(n){return{stop:n,location:o,custom:!!e.customLocationFlag}}throw Error(JSON.stringify(o))})}function h(e,t){const n=new URLSearchParams;switch(e){case o.ROUTE:n.set("route",t),null!=s.Route.TRIP&&n.set("trip",s.Route.TRIP),null!=s.STOP&&n.set("stop",s.STOP);break;case o.STOP:null!=s.Route.ID&&n.set("route",s.Route.ID),n.set("stop",t),null!=s.Route.TRIP&&n.set("trip",s.Route.TRIP);break;case o.TRIP:n.set("route",s.Route.ID),n.set("trip",t),null!=s.STOP&&n.set("stop",s.STOP);break;default:console.warn("Invalid type provided for link: %i",e)}return`#!${n}`}function f(e,t,o,n){return Object.assign(e,{Type:t,Value:o,href:h(t,o)}),e.href=h(t,o),e.addEventListener("click",P),n&&e.addEventListener("pageupdate",function(){e.href=h(t,o)}),e}function I(e,t,o){return f(document.createElement("a"),e,t,o)}function P(e){var t,n,i,r;return null===(n=(t=e).preventDefault)||void 0===n||n.call(t),null===(r=(i=e).stopPropagation)||void 0===r||r.call(i),function(e){var t;const n=s,i=e.Value,r=h(e.Type,i),c=a[e.Type];switch(e.Type){case o.ROUTE:n.Route.ID=i;break;case o.STOP:n.STOP=i;break;case o.TRIP:n.Route.TRIP=i}c(i),history.pushState(n,null,r),null===(t=ga)||void 0===t||t("send","pageview",{page:r,title:document.title})}(this),!1}function w(){let e,t="";window.location.hash.indexOf("#!")>-1?e=(t=window.location.hash.substring(window.location.hash.indexOf("#!")+2)).split("&"):window.location.search.indexOf("_escaped_fragment_")>-1&&(e=(t=window.location.search.substring(window.location.search.indexOf("_escaped_fragment_")+19)).split("%26"));const o={};if(""!==t)for(const t of e){const[e,n]=t.split("=");o[e]=n}return o}function T(t){if("string"==typeof t&&t.indexOf(":")>-1&&t.lastIndexOf(":")>t.indexOf(":")){const[o,n,s]=t.split(":").map(e);t=new Date(0,0,0,o,n,s,0)}if("object"!=typeof t)throw new TypeError(`date must be Date or string, not ${typeof t}`);let o="am",n="",s="";const i=t.getHours(),a=t.getMinutes();if(0===i)n="12";else if(12===i)n="12",o="pm";else if(i>12){n=(i-12).toString(),o="pm"}else n=i.toString();return n+(s=0===a?"":a<10?":0"+a.toString():":"+a.toString())+o}function _(t){const[o,n,s]=t.split(":").map(t=>e(t));let i=0,a=0;return o>23&&(i=Math.floor(o/24),a=o%24),new Date(0,0,0+i,o+a,n,s,0)}function R(e){return T(_(e))}let v,y,E,S,O,L,C=[];const B="interactive"===document.readyState||"complete"===document.readyState?Promise.resolve(document.readyState):new Promise(e=>{document.addEventListener("readystatechange",()=>{"interactive"===document.readyState&&e(document.readyState)})}),x=fetch("api.json").then(e=>{if(e.ok)return e.json();throw new Error(e.statusText)}).then(e=>e),M=m(x);let b;try{!function(){if(!navigator.onLine||"object"!=typeof google||"object"!=typeof google.maps)throw B.then(function(){document.body.classList.add("no-map")}),new Error("Google Maps API has not loaded");S=new google.maps.LatLngBounds,C=[],Promise.all([B.then(function(){return Promise.resolve().then(()=>{const e=s.View.STOP===n.MAP_PRIMARY?document.getElementById("map-canvas"):document.getElementById("streetview-canvas"),t=s.View.STOP===n.STREET_PRIMARY?document.getElementById("map-canvas"):document.getElementById("streetview-canvas");return v=new google.maps.Map(e,{center:new google.maps.LatLng(19.6,-155.56),zoom:10,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},panControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}),y=new google.maps.StreetViewPanorama(t,{position:new google.maps.LatLng(19.723835,-155.084741),visible:!0,pov:{heading:34,pitch:0},scrollwheel:!1,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_CENTER},addressControl:!1}),v.setStreetView(y),(E=new google.maps.places.Autocomplete(document.getElementById("search"))).bindTo("bounds",v),google.maps.event.addListener(E,"place_changed",function(){const e=E.getPlace();if(!e.geometry)return;const t=e.geometry.location;console.log("Lat %s, Lon %s",t.lat(),t.lng()),m(x,{latitude:t.lat(),longitude:t.lng()}).then(e=>{b||((b=new google.maps.Marker({position:new google.maps.LatLng(e.location.latitude,e.location.longitude),title:"Search Location",icon:d,map:v,animation:google.maps.Animation.DROP,zIndex:1e3})).Type=o.STOP,google.maps.event.addListener(b,"click",P)),b.Value=e.stop,N(e.stop)})}),v})}),x.then(function(e){return Promise.resolve().then(()=>{for(const t of Object.values(e.stops)){const e=new google.maps.Marker({position:k(t),title:t.stop_name,icon:r});e.Type=o.STOP,e.Value=t.stop_id,e.stop_id=t.stop_id,google.maps.event.addListener(e,"click",P),S.extend(e.getPosition()),C.push(e)}return{markers:C,bounds:S}})})]).then(function([e,{markers:t,bounds:n}]){e.setCenter(n.getCenter()),e.fitBounds(n),google.maps.event.addListener(e,"bounds_changed",function(){const o=e.getBounds();for(const n of t)o.contains(n.getPosition())?n.getMap()!==e&&n.setMap(e):n.setMap(null)}),t.forEach(t=>t.setMap(e)),M.then(function(t){(O=new google.maps.Marker({position:new google.maps.LatLng(t.location.latitude,t.location.longitude),title:t.custom?"Location of Place":"My Location",icon:t.custom?d:l,map:e,animation:google.maps.Animation.DROP,zIndex:1e3})).Type=o.STOP,O.Value=t.stop,google.maps.event.addListener(O,"click",P),s.STOP||N(t.stop),window.addEventListener("locationupdate",e=>{const{custom:t,location:o}=e.detail;O.setIcon(t?d:l),O.setPosition(new google.maps.LatLng(o.latitude,o.longitude))})})}),window.addEventListener("resize",function(){google.maps.event.trigger(v,"resize"),google.maps.event.trigger(y,"resize"),s.Route.ID||(v.setCenter(S.getCenter()),v.fitBounds(S))})}()}catch(e){console.error(e),M.then(function(e){s.STOP||N(e.stop)})}function k(e){return new google.maps.LatLng(parseFloat(e.stop_lat),parseFloat(e.stop_lon))}function D(e){return console.log(e),Promise.all([V(e.Route.ID).then(t=>j(e.Route.TRIP?e.Route.TRIP:t)),e.STOP?N(e.STOP):void 0]).then(()=>{})}function A(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function z(){if(!v||!y)throw console.error("Map and StreetViewPanorama have not loaded"),new TypeError;const e=document.getElementById("map"),t=document.getElementById("streetview-header");s.View.STOP===n.MAP_PRIMARY?(e.insertBefore(document.getElementById("streetview-canvas"),e.firstChild),t.insertBefore(document.getElementById("map-canvas"),e.firstChild),this.classList.add("on"),s.View.STOP=n.STREET_PRIMARY):s.View.STOP===n.STREET_PRIMARY&&(e.insertBefore(document.getElementById("map-canvas"),e.firstChild),t.insertBefore(document.getElementById("streetview-canvas"),e.firstChild),this.classList.remove("on"),s.View.STOP=n.MAP_PRIMARY),dispatchEvent(i)}function V(t){return x.then(o=>{const n=o.routes[t];if(!n||!n.route_id)return void console.error("Invalid Route %s",t);let a,l;s.Route.ID=t,s.Route.TRIP=null,document.title=n.route_long_name,document.body.style.setProperty("--route-color",`#${n.route_color}`),document.body.style.setProperty("--route-text-color",`#${n.route_text_color}`),document.getElementById("route_long_name").textContent=n.route_long_name;let d,p,m=0,h=new Date(0,0,0,23,59,59,0),f=new Date(0,0,0,0,0,0,0);const I=function(){const e=new Date;return new Date(0,0,0,e.getHours(),e.getMinutes(),e.getSeconds(),0)}();let P,w,R=Number.MAX_VALUE;const E=document.getElementById("trip-select");A(E);const S=new Set;for(const t of Object.keys(n.trips)){const o=n.trips[t];for(const t in o.stop_times){"1"==t&&0===e(o.direction_id)?a=o.stop_times[t].stop_id:e(t)>m&&0===e(o.direction_id)&&(m=e(t),l=o.stop_times[t].stop_id),S.add(o.stop_times[t].stop_id);const n=_(o.stop_times[t].arrival_time);n>f&&(f=n),n<h&&(h=n,d=o.trip_id,p=o.stop_times[t].stop_id),n.getTime()-I.getTime()<R&&n.getTime()-I.getTime()>0&&(R=n.getTime()-I.getTime(),P=o.trip_id,w=o.stop_times[t].stop_id)}P||(R=new Date(0,0,1,h.getHours(),h.getMinutes(),h.getSeconds(),0).getTime()-I.getTime(),P=d,w=p);const s=g("option",{value:o.trip_id,textContent:o.trip_short_name});E.appendChild(s)}const O=1!=Math.floor(R/6e4)?Math.floor(R/6e4)+" minutes":"1 minute";if(document.getElementById("place-value").textContent="Between "+o.stops[a].stop_name+" - "+o.stops[l].stop_name,document.getElementById("time-value").textContent=T(h)+" - "+T(f),document.getElementById("next-stop-value").textContent="Reaches "+o.stops[w].stop_name+" in "+O,document.getElementById("main").classList.add("open"),navigator.onLine&&"object"==typeof google&&"object"==typeof google.maps){const e=new google.maps.LatLngBounds;for(const t of C)S.has(t.stop_id)?(t.setIcon(r),t.setZIndex(200),t.activeInRoute=!0,e.extend(t.getPosition())):(t.setIcon(c),t.setZIndex(null),t.activeInRoute=!1);L&&(L.setIcon(u),L.setZIndex(300)),google.maps.event.trigger(v,"resize"),v.setCenter(e.getCenter()),v.fitBounds(e),google.maps.event.trigger(y,"resize")}return window.dispatchEvent(i),j(P),P})}function N(e){return x.then(t=>{const n=t.stops[e];if(!n||!n.stop_id)return void console.error("Invalid Stop %s",e);if(s.STOP=e,y&&y.setPosition(k(n)),v){for(const e of C)e.activeInRoute||null==s.Route.ID?e.setIcon(r):e.setIcon(c),e.stop_id===n.stop_id&&(L=e);L.setIcon(u),L.setZIndex(300),y.setPosition(L.getPosition()),google.maps.event.trigger(y,"resize"),google.maps.event.addListener(y,"pano_changed",function(){document.getElementById("address").textContent=y.getLocation().description,y.setPov(y.getPhotographerPov())})}y||document.getElementById("stop").classList.add("no-streetview"),document.getElementById("stop_name").textContent=n.stop_name;const a=document.getElementById("connections");A(a);for(const e of n.routes){const n=t.routes[e],i=I(o.ROUTE,e,!1);i.className="connections__link",i.style.borderColor=`#${n.route_color}`,i.textContent=n.route_long_name;const r=document.createElement("li");r.className="connections__item",r.append(i),s.Route.ID===e&&r.classList.add("connections__item--active-route"),a.append(r)}document.getElementById("main").classList.add("open-stop"),window.dispatchEvent(i)})}function j(t){return x.then(n=>{const a=n.routes[s.Route.ID].trips[t];if(!a||!a.trip_id)return void console.error("Invalid trip %s in route %s",t,s.Route.ID);s.Route.TRIP=t;const r=document.getElementById("schedule");A(r);const c=function(t){const o=[];for(const e in t)o.push(e);return o.sort((t,o)=>e(t)-e(o))}(a.stop_times),l=document.getElementById("trip-select");for(let e=0;e<l.options.length;e++)if(l.options[e].value===t){l.selectedIndex=e,l.options[e].selected=!0;break}document.getElementById("week-days-value").textContent=n.calendar[a.service_id].text_name;for(const e of c){const t=a.stop_times[e],i=I(o.STOP,t.stop_id);i.className="schedule__stop";const c=g("div",{className:"lines"});for(let e=0;e<2;e++){const e=g("span",{className:"line"});c.appendChild(e)}i.appendChild(c);const l=g("span",{className:"schedule__stopname name",textContent:n.stops[t.stop_id].stop_name});i.appendChild(l);const d=g("time",{className:"schedule__time",textContent:R(t.arrival_time)});i.appendChild(d);const u=g("div",{className:"connections"});for(const e of n.stops[t.stop_id].routes){if(e===s.Route.ID)continue;const t=g("span",{className:"route-dash",title:n.routes[e].route_long_name});t.style.backgroundColor=n.routes[e].route_color,u.appendChild(t)}i.appendChild(u),r.appendChild(i)}window.dispatchEvent(i)})}Promise.all([B.then(function(){const e=document.getElementById("nearby"),t=document.getElementById("other"),n=new Map;for(const e of t.children){const t=e,s=t.dataset.route;f(t.querySelector("a.routes__link"),o.ROUTE,s,!0),n.set(s,t)}let s=!0;return function(o){if(s)for(;e.firstChild;)e.removeChild(e.firstChild);s=!1;for(const[s,i]of n)o.has(s)?e.appendChild(i):t.appendChild(i)}}),x,M]).then(([e,t,o])=>{e(new Set(t.stops[o.stop].routes))}),B.then(function(){!function(){navigator.onLine||document.getElementById("main").classList.add("offline");document.getElementById("map-toggle").addEventListener("click",z);const e=document.getElementById("trip-select");function t(){document.getElementById("aside").classList.toggle("open")}e.Type=o.TRIP,e.addEventListener("change",function(t){e.Value=e.options[e.selectedIndex].value,P.call(e,t)}),document.getElementById("screen-cover").addEventListener("click",t),document.getElementById("menu").addEventListener("click",t),document.getElementById("alt-menu").addEventListener("click",t)}()}),Promise.all([B,x]).then(function(){if(!window.history.state&&window.location.search.includes("#!")){const e=w();s.Route.ID=e.route||s.Route.ID,s.Route.TRIP=e.trip||s.Route.TRIP,s.STOP=e.stop||s.STOP,D(s)}else window.history.state&&(p(window.history.state),D(s))}),window.onhashchange=function(){const e=w();s.Route.ID=e.route||s.Route.ID,s.Route.TRIP=e.trip||s.Route.TRIP,s.STOP=e.stop||s.STOP,D(s)},window.onpopstate=function(e){p(e.state),D(s)},a[o.ROUTE]=V,a[o.STOP]=N,a[o.TRIP]=j}();
//# sourceMappingURL=main.js.map
