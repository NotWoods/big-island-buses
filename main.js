!function(){"use strict";var e,t;!function(e){e[e.ROUTE=0]="ROUTE",e[e.STOP=1]="STOP",e[e.TRIP=2]="TRIP"}(e||(e={})),function(e){e[e.LIST=0]="LIST",e[e.TIMETABLE=1]="TIMETABLE",e[e.MAP_PRIMARY=2]="MAP_PRIMARY",e[e.STREET_PRIMARY=3]="STREET_PRIMARY"}(t||(t={}));let o={Route:{ID:null,TRIP:null},STOP:null,View:{ROUTE:t.LIST,STOP:t.MAP_PRIMARY}};const n=new CustomEvent("pageupdate");navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js");const s={},i={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:0,y:0},anchor:{x:12,y:12}},r={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:96,y:0},anchor:{x:12,y:12}},a={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:48,y:0},anchor:{x:12,y:12}},l={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:72,y:0},anchor:{x:12,y:23}},c={url:"assets/pins.png",size:{height:26,width:24},scaledSize:{height:26,width:120},origin:{x:24,y:0},anchor:{x:12,y:20}};function d(e){o=e}function u(e,t){let o;o=t?Promise.resolve({coords:t,customLocationFlag:!0}):new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)});let n,s=Number.MAX_VALUE;return Promise.all([o,e]).then(([e,t])=>{const o=e.coords;for(const e of Object.keys(t.stops)){const i=t.stops[e],r=Math.sqrt(Math.pow(o.latitude-parseFloat(i.stop_lat),2)+Math.pow(o.longitude-parseFloat(i.stop_lon),2));r<s&&(n=e,s=r)}if(n){return{stop:n,location:o,custom:!!e.customLocationFlag}}throw Error(JSON.stringify(o))})}function p(t,n){let s="";switch(t){case e.ROUTE:s+="#!route="+n,null!==o.Route.TRIP&&(s+="&trip="+o.Route.TRIP),null!==o.STOP&&(s+="&stop="+o.STOP);break;case e.STOP:null!==o.Route.ID?s+="#!route="+o.Route.ID:s+="#!",s+="&stop="+n,null!==o.Route.TRIP&&(s+="&trip="+o.Route.TRIP);break;case e.TRIP:s+="#!route= "+o.Route.ID+"&trip="+n,null!==o.STOP&&(s+="&stop="+o.STOP);break;default:console.warn("Invalid type provided for link: %i",t)}return s}function m(e,t,o){const n=document.createElement("a");return n.Type=e,n.Value=t,n.href=p(e,t),n.addEventListener("click",g),o&&n.addEventListener("pageupdate",function(){n.href=p(e,t)}),n}function g(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();const n=o,i=this.Value,r=p(this.Type,i),a=s[this.Type];switch(this.Type){case e.ROUTE:n.Route.ID=i;break;case e.STOP:n.STOP=i;break;case e.TRIP:n.Route.TRIP=i}return a(i),history.pushState(n,null,r),ga&&ga("send","pageview",{page:r,title:document.title}),!1}function h(e){if("string"==typeof e&&e.indexOf(":")>-1&&e.lastIndexOf(":")>e.indexOf(":")){const t=e.split(":");e=new Date(0,0,0,parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}if("object"!=typeof e)throw new TypeError(`date must be Date or string, not ${typeof e}`);let t="am",o="",n="";const s=e.getHours(),i=e.getMinutes();if(0===s)o="12";else if(12===s)o="12",t="pm";else if(s>12){o=(s-12).toString(),t="pm"}else o=s.toString();return o+(n=0===i?"":i<10?":0"+i.toString():":"+i.toString())+t}function f(e){const[t,o,n]=e.split(":").map(e=>parseInt(e,10));let s=0,i=0;return t>23&&(s=Math.floor(t/24),i=t%24),new Date(0,0,0+s,t+i,o,n,0)}function I(e){return h(f(e))}function T(e){let t,o="";if(window.location.hash.indexOf("#!")>-1?t=(o=window.location.hash.substring(window.location.hash.indexOf("#!")+2)).split("&"):window.location.search.indexOf("_escaped_fragment_")>-1&&(t=(o=window.location.search.substring(window.location.search.indexOf("_escaped_fragment_")+19)).split("%26")),""!==o)for(const o of t){const[t,n]=o.split("=");if(t===e)return n}return null}let P,w,R,_,E,v,y=[];const L="interactive"===document.readyState||"complete"===document.readyState?Promise.resolve(document.readyState):new Promise(e=>{document.addEventListener("readystatechange",()=>{"interactive"===document.readyState&&e(document.readyState)})}),S=(O="api.json",C="json",new Promise((e,t)=>{const o=new XMLHttpRequest;o.open("GET",O),C&&(o.responseType=C),o.onload=function(){200===this.status?e(this.response):t(Error(this.statusText))},o.onerror=function(){t(Error("Network Error"))},o.send()})).then(e=>e);var O,C;const B=u(S);let x;function M(e){return new google.maps.LatLng(parseFloat(e.stop_lat),parseFloat(e.stop_lon))}function b(e){return console.log(e),Promise.all([A(e.Route.ID).then(t=>V(e.Route.TRIP?e.Route.TRIP:t)),z(e.STOP)]).then(()=>{})}function k(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function D(){if(!P||!w)throw console.error("Map and StreetViewPanorama have not loaded"),new TypeError;const e=document.getElementById("map"),s=document.getElementById("streetview-header");o.View.STOP==t.MAP_PRIMARY?(e.insertBefore(document.getElementById("streetview-canvas"),e.firstChild),s.insertBefore(document.getElementById("map-canvas"),e.firstChild),this.classList.add("on"),o.View.STOP=t.STREET_PRIMARY):o.View.STOP==t.STREET_PRIMARY&&(e.insertBefore(document.getElementById("map-canvas"),e.firstChild),s.insertBefore(document.getElementById("streetview-canvas"),e.firstChild),this.classList.remove("on"),o.View.STOP=t.MAP_PRIMARY),dispatchEvent(n)}function A(e){return S.then(t=>{const s=t.routes[e];if(!s||!s.route_id)return void console.error("Invalid Route %s",e);o.Route.ID=e,o.Route.TRIP=null,document.title=s.route_long_name;const a=document.getElementById("route_long_name");let l,d;a.textContent=s.route_long_name,a.style.backgroundColor=`#${s.route_color}`,a.style.color=`#${s.route_text_color}`,document.getElementById("alt-menu").style.fill=`#${s.route_text_color}`;let u,p,m=0,g=new Date(0,0,0,23,59,59,0),I=new Date(0,0,0,0,0,0,0);const T=function(){const e=new Date;return new Date(0,0,0,e.getHours(),e.getMinutes(),e.getSeconds(),0)}();let R,_,E=Number.MAX_VALUE;const L=document.getElementById("trip-select");k(L);const S=new Set;for(const e of Object.keys(s.trips)){const t=s.trips[e];for(const e in t.stop_times){"1"==e&&0===parseInt(t.direction_id,10)?l=t.stop_times[e].stop_id:parseInt(e,10)>m&&0===parseInt(t.direction_id,10)&&(m=parseInt(e,10),d=t.stop_times[e].stop_id),S.add(t.stop_times[e].stop_id);const o=f(t.stop_times[e].arrival_time);o>I&&(I=o),o<g&&(g=o,u=t.trip_id,p=t.stop_times[e].stop_id),o.getTime()-T.getTime()<E&&o.getTime()-T.getTime()>0&&(E=o.getTime()-T.getTime(),R=t.trip_id,_=t.stop_times[e].stop_id)}R||(E=new Date(0,0,1,g.getHours(),g.getMinutes(),g.getSeconds(),0).getTime()-T.getTime(),R=u,_=p);const o=document.createElement("option");o.value=t.trip_id,o.textContent=t.trip_short_name,L.appendChild(o)}const O=1!=Math.floor(E/6e4)?Math.floor(E/6e4)+" minutes":"1 minute";if(document.getElementById("place-value").textContent="Between "+t.stops[l].stop_name+" - "+t.stops[d].stop_name,document.getElementById("time-value").textContent=h(g)+" - "+h(I),document.getElementById("next-stop-value").textContent="Reaches "+t.stops[_].stop_name+" in "+O,document.getElementById("main").classList.add("open"),navigator.onLine&&"object"==typeof google&&"object"==typeof google.maps){const e=new google.maps.LatLngBounds;for(const t of y)S.has(t.stop_id)?(t.setIcon(i),t.setZIndex(200),t.activeInRoute=!0,e.extend(t.getPosition())):(t.setIcon(r),t.setZIndex(null),t.activeInRoute=!1);v&&(v.setIcon(c),v.setZIndex(300)),google.maps.event.trigger(P,"resize"),P.setCenter(e.getCenter()),P.fitBounds(e),google.maps.event.trigger(w,"resize")}return window.dispatchEvent(n),V(R),R})}function z(t){return S.then(s=>{const a=s.stops[t];if(!a||!a.stop_id)return void console.error("Invalid Stop %s",t);if(o.STOP=t,w&&w.setPosition(M(a)),P){for(const e of y)e.activeInRoute||null==o.Route.ID?e.setIcon(i):e.setIcon(r),e.stop_id===a.stop_id&&(v=e);v.setIcon(c),v.setZIndex(300),w.setPosition(v.getPosition()),google.maps.event.trigger(w,"resize"),google.maps.event.addListener(w,"pano_changed",function(){document.getElementById("address").textContent=w.getLocation().description,w.setPov(w.getPhotographerPov())})}w||document.getElementById("stop").classList.add("no-streetview"),document.getElementById("stop_name").textContent=a.stop_name;const l=document.getElementById("connections");k(l);for(const t of a.routes){const n=s.routes[t],i=m(e.ROUTE,t,!1);i.style.borderColor=`#${n.route_color}`,i.textContent=n.route_long_name;const r=document.createElement("li");r.append(i),o.Route.ID===t&&(r.className="active-route"),l.append(r)}document.getElementById("main").classList.add("open-stop"),window.dispatchEvent(n)})}function V(t){return S.then(s=>{const i=s.routes[o.Route.ID],r=i.trips[t];if(!r||!r.trip_id)return void console.error("Invalid trip %s in route %s",t,o.Route.ID);o.Route.TRIP=t;const a=document.getElementById("schedule");k(a);const l=function(e){const t=[];for(const o in e)t.push(o);return t.sort((e,t)=>parseInt(e,10)-parseInt(t,10))}(r.stop_times),c=document.getElementById("trip-select");for(let e=0;e<c.options.length;e++)if(c.options[e].value===t){c.selectedIndex=e,c.options[e].selected=!0;break}document.getElementById("week-days-value").textContent=s.calendar[r.service_id].text_name;for(const t of l){const n=r.stop_times[t],l=m(e.STOP,n.stop_id),c=document.createElement("div");c.className="lines";for(let e=0;e<2;e++){const e=document.createElement("span");e.className="line",e.style.backgroundColor=`#${i.route_color}`,c.appendChild(e)}l.appendChild(c);const d=document.createElement("span");d.className="name",d.textContent=s.stops[n.stop_id].stop_name,l.appendChild(d);const u=document.createElement("time");u.textContent=I(n.arrival_time),l.appendChild(u);const p=document.createElement("div");p.className="connections";for(const e of s.stops[n.stop_id].routes){if(e===o.Route.ID)continue;const t=document.createElement("span");t.className="route-dash",t.title=s.routes[e].route_long_name,t.style.backgroundColor=s.routes[e].route_color,p.appendChild(t)}l.appendChild(p),a.appendChild(l)}window.dispatchEvent(n)})}!1===function(){if(!navigator.onLine||"object"!=typeof google||"object"!=typeof google.maps)return console.error("Google Maps API has not loaded"),L.then(function(){document.body.classList.add("no-map")}),!1;_=new google.maps.LatLngBounds,y=[],Promise.all([L.then(function(){return Promise.resolve().then(()=>{const n=o.View.STOP===t.MAP_PRIMARY?document.getElementById("map-canvas"):document.getElementById("streetview-canvas"),s=o.View.STOP===t.STREET_PRIMARY?document.getElementById("map-canvas"):document.getElementById("streetview-canvas");return P=new google.maps.Map(n,{center:new google.maps.LatLng(19.6,-155.56),zoom:10,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},panControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}),w=new google.maps.StreetViewPanorama(s,{position:new google.maps.LatLng(19.723835,-155.084741),visible:!0,pov:{heading:34,pitch:0},scrollwheel:!1,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_CENTER},addressControl:!1}),P.setStreetView(w),(R=new google.maps.places.Autocomplete(document.getElementById("search"))).bindTo("bounds",P),google.maps.event.addListener(R,"place_changed",function(){const t=R.getPlace();if(!t.geometry)return;const o=t.geometry.location;console.log("Lat %s, Lon %s",o.lat(),o.lng()),u(S,{latitude:o.lat(),longitude:o.lng()}).then(t=>{x||((x=new google.maps.Marker({position:new google.maps.LatLng(t.location.latitude,t.location.longitude),title:"Search Location",icon:l,map:P,animation:google.maps.Animation.DROP,zIndex:1e3})).Type=e.STOP,google.maps.event.addListener(x,"click",g)),x.Value=t.stop,z(t.stop)})}),P})}),S.then(function(t){return Promise.resolve().then(()=>{for(const o of Object.values(t.stops)){const t=new google.maps.Marker({position:M(o),title:o.stop_name,icon:i});t.Type=e.STOP,t.Value=o.stop_id,t.stop_id=o.stop_id,google.maps.event.addListener(t,"click",g),_.extend(t.getPosition()),y.push(t)}return{markers:y,bounds:_}})})]).then(function([t,{markers:n,bounds:s}]){t.setCenter(s.getCenter()),t.fitBounds(s),google.maps.event.addListener(t,"bounds_changed",function(){const e=t.getBounds();for(const o of n)e.contains(o.getPosition())?o.getMap()!==t&&o.setMap(t):o.setMap(null)}),n.forEach(e=>e.setMap(t)),B.then(function(n){(E=new google.maps.Marker({position:new google.maps.LatLng(n.location.latitude,n.location.longitude),title:n.custom?"Location of Place":"My Location",icon:n.custom?l:a,map:t,animation:google.maps.Animation.DROP,zIndex:1e3})).Type=e.STOP,E.Value=n.stop,google.maps.event.addListener(E,"click",g),o.STOP||z(n.stop),window.addEventListener("locationupdate",e=>{const{custom:t,location:o}=e.detail;E.setIcon(t?l:a),E.setPosition(new google.maps.LatLng(o.latitude,o.longitude))})})}),window.addEventListener("resize",function(){google.maps.event.trigger(P,"resize"),google.maps.event.trigger(w,"resize"),o.Route.ID||(P.setCenter(_.getCenter()),P.fitBounds(_))})}()&&B.then(function(e){o.STOP||z(e.stop)}),S.then(function(t){let o=null;const n=[];function s(e){const o=document.getElementById("nearby"),n=document.getElementById("other");n.append(...e.routeListItems),B.then(function(s){for(const i of e.routeListItems)t.stops[s.stop].routes.includes(i.route_id)?o.appendChild(i):n.appendChild(i)})}L.then(function(){null!=o?s(o):(!function(){for(const o of Object.values(t.routes)){const t=document.createElement("li");t.style.borderColor=`#${o.route_color}`,t.route_id=o.route_id;const s=m(e.ROUTE,o.route_id,!0);s.textContent=o.route_long_name,t.append(s),n.push(t)}}(),(o=document.getElementById("aside")).routeListItems=n,s(o))})}),L.then(function(){!function(){navigator.onLine||document.getElementById("main").classList.add("offline");document.getElementById("map-toggle").addEventListener("click",D);const t=document.getElementById("trip-select");function o(){document.getElementById("aside").classList.toggle("open")}t.Type=e.TRIP,t.addEventListener("change",function(e){t.Value=t.options[t.selectedIndex].value,g.call(t,e)}),document.getElementById("screen-cover").addEventListener("click",o),document.getElementById("menu").addEventListener("click",o),document.getElementById("alt-menu").addEventListener("click",o)}()}),Promise.all([L,S]).then(function(){!window.history.state&&window.location.search.indexOf("#!")>-1?(o.Route.ID=T("route")?T("route"):o.Route.ID,o.Route.TRIP=T("trip")?T("trip"):o.Route.TRIP,o.STOP=T("stop")?T("stop"):o.STOP,b(o)):window.history.state&&(d(window.history.state),b(o))}),window.onhashchange=function(){o.Route.ID=T("route")?T("route"):o.Route.ID,o.Route.TRIP=T("trip")?T("trip"):o.Route.TRIP,o.STOP=T("stop")?T("stop"):o.STOP,b(o)},window.onpopstate=function(e){d(e.state),b(o)},s[e.ROUTE]=A,s[e.STOP]=z,s[e.TRIP]=V}();
//# sourceMappingURL=main.js.map
