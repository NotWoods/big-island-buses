{"version":3,"file":"service-worker.js","sources":["../consts:closestStopWorker","../src/service-worker.ts"],"sourcesContent":["export default \"worker/closest-stop.js\"","import closestStopWorker from 'consts:closestStopWorker';\n\nconst CACHE = 'big-island-buses-4';\n\nexport declare var self: ServiceWorkerGlobalScope;\n\nself.addEventListener('install', evt => {\n  evt.waitUntil(precache());\n});\n\nself.addEventListener('fetch', evt => {\n  const url = new URL(evt.request.url);\n\n  if (url.host === location.host) {\n    if (url.pathname.includes('/routes/')) {\n      // Route pages have same layout as main page\n      evt.respondWith(fromCache('index.html'));\n    } else {\n      // Network then fallback\n      evt.respondWith(fromCache(evt.request));\n\n      evt.waitUntil(update(evt.request));\n    }\n  } else {\n    // External scripts (Google Maps) aren't cached\n    evt.respondWith(fetch(evt.request));\n  }\n});\n\nfunction precache() {\n  return caches\n    .open(CACHE)\n    .then(cache =>\n      cache.addAll([\n        './',\n        'index.html',\n        'style.css',\n        'main.js',\n        'api.json',\n        'manifest.json',\n        'assets/logo.svg',\n        'assets/pins.png',\n        'assets/lines.svg',\n        'assets/tigeroakes.svg',\n        'icon/favicon.ico',\n        'icon/maskable.png',\n        'icon/transparent.png',\n        closestStopWorker,\n      ]),\n    );\n}\n\nfunction fromCache(request: RequestInfo) {\n  return caches\n    .open(CACHE)\n    .then(cache => cache.match(request))\n    .then(matching => {\n      if (matching) {\n        return matching;\n      } else {\n        const url = typeof request === 'string' ? request : request.url;\n        throw new Error(`${url} not cached`);\n      }\n    });\n}\n\nfunction update(request: RequestInfo) {\n  return caches.open(CACHE).then(cache => {\n    return fetch(request).then(response => {\n      return cache.put(request, response);\n    });\n  });\n}\n"],"names":["CACHE","fromCache","request","caches","open","then","cache","match","matching","url","Error","self","addEventListener","evt","waitUntil","addAll","closestStopWorker","URL","host","location","pathname","includes","respondWith","fetch","response","put","update"],"mappings":"AAAA,MAAe,yBCEf,MAAMA,EAAQ,qBAkDd,SAASC,EAAUC,GACjB,OAAOC,OACJC,KAAKJ,GACLK,KAAKC,GAASA,EAAMC,MAAML,IAC1BG,KAAKG,IACJ,GAAIA,EACF,OAAOA,EACF,CACL,MAAMC,EAAyB,iBAAZP,EAAuBA,EAAUA,EAAQO,IAC5D,MAAM,IAAIC,SAASD,mBAvD3BE,KAAKC,iBAAiB,UAAWC,IAC/BA,EAAIC,UAuBGX,OACJC,KAAKJ,GACLK,KAAKC,GACJA,EAAMS,OAAO,CACX,KACA,aACA,YACA,UACA,WACA,gBACA,kBACA,kBACA,mBACA,wBACA,mBACA,oBACA,uBACAC,QArCRL,KAAKC,iBAAiB,QAASC,IAC7B,MAAMJ,EAAM,IAAIQ,IAAIJ,EAAIX,QAAQO,KAE5BA,EAAIS,OAASC,SAASD,KACpBT,EAAIW,SAASC,SAAS,YAExBR,EAAIS,YAAYrB,EAAU,gBAG1BY,EAAIS,YAAYrB,EAAUY,EAAIX,UAE9BW,EAAIC,UA6CV,SAAgBZ,GACd,OAAOC,OAAOC,KAAKJ,GAAOK,KAAKC,GACtBiB,MAAMrB,GAASG,KAAKmB,GAClBlB,EAAMmB,IAAIvB,EAASsB,KAhDZE,CAAOb,EAAIX,WAI3BW,EAAIS,YAAYC,MAAMV,EAAIX"}